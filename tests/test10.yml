---
# export ANSIBLE_STDOUT_CALLBACK=debug
- name: lookup services and networks
  hosts: localhost
  gather_facts: false
  vars:
    def_dir: "tests/integration/targets/translate/files/def"
    servicelist:
      - BGP
      - DNS
    networklist:
      - PUBLIC_NAT
      - NTP_SERVERS

  tasks:

    - name: lookup existing
      ansible.builtin.debug:
        msg:
          - "{{ lookup('nleiva.capirca_acl.service', 'HTTP', dir=def_dir) }}"
          - "{{ lookup('nleiva.capirca_acl.service', 'HTTP', 'HTTPS', dir=def_dir) }}"
          - "{{ lookup('nleiva.capirca_acl.service', *servicelist, dir=def_dir) }}"
          - "{{ lookup('nleiva.capirca_acl.network', 'WEB_SERVERS', dir=def_dir) }}"
          - "{{ lookup('nleiva.capirca_acl.network', 'TACACS_SERVERS', 'WEB_SERVERS', dir=def_dir) }}"
          - "{{ lookup('nleiva.capirca_acl.network', *networklist, dir=def_dir) }}"

    - name: lookup non existing warn
      ansible.builtin.debug:
        msg:
          - "{{ lookup('nleiva.capirca_acl.service', 'HTTPfoo', dir=def_dir, errors='warn') }}"
          - "{{ lookup('nleiva.capirca_acl.network', 'WEB_SERVERSfoo', dir=def_dir, errors='warn') }}"

    # ansible tasks do not pass environment variables defined with environment: to the lookup
    # plugin and we cannot test for that.

    # this procudes ugly red output but does not fail
    # - name: lookup non existing error
      # ansible.builtin.debug:
        # msg:
          # - "{{ lookup('nleiva.capirca_acl.service', 'HTTPfoo', dir=def_dir, errors='error') }}"
          # - "{{ lookup('nleiva.capirca_acl.network', 'WEB_SERVERSfoo', dir=def_dir, errors='error') }}"
      # ignore_errors: true
